{"version":3,"sources":["Uploader/Uploader.js","Sidebar/Sidebar.js","Canvas/Canvas.js","App.js","reportWebVitals.js","index.js"],"names":["Uploader","API_URL","resetState","setImageFilename","setIsLoading","onUpload","event","a","fetch","method","body","target","files","response","json","filename","console","error","preventDefault","className","htmlFor","id","onChange","type","Sidebar","deleteShape","distances","hasVisibleBorders","savedShapes","setDistances","setHasVisibleBorders","setSteps","steps","updateSetting","value","index","func","v","Math","max","parseInt","map","shape","e","onClick","join","checked","Canvas","addShape","canvasRef","imageUrl","currentShapeRef","useRef","useState","isVerticalRatio","setIsVerticalRatio","image","setImage","useEffect","img","Image","src","decoding","decode","then","width","height","drawRectContext","setDrawRectContext","refreshImage","useCallback","context","current","clientWidth","clientHeight","drawImage","refreshShapes","i","startX","startY","strokeStyle","strokeRect","redrawCanvas","sharedContext","getContext","clearRect","getCanvasCoords","clientX","clientY","rect","getBoundingClientRect","x","left","y","top","onMouseUp","onMouseDown","coords","onMouseLeave","onMouseMove","ref","App","imageFilename","isLoading","setSavedShapes","removeFromArray","array","filter","exists","isPreview","length","JSON","stringify","href","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.7cca2b06.chunk.js","sourcesContent":["import React from 'react';\n\nconst Uploader = ({ API_URL, resetState, setImageFilename, setIsLoading }) => {\n  const onUpload = async event => {\n    setIsLoading(true);\n    resetState();\n    try {\n      const response = await fetch(API_URL + '/upload', {\n        method: 'POST',\n        body: event.target.files[0]\n      });\n      const { filename } = await response.json();\n      setImageFilename(filename);\n    } catch(error) {\n      console.error(error);\n    }\n    setIsLoading(false);\n    event.preventDefault();\n  };\n\n  return (\n    <div className=\"uploader\">\n      <label htmlFor=\"upload\">Load image</label>\n      <input id=\"upload\" onChange={onUpload} type=\"file\" />\n    </div>\n  );\n}\n\nexport default Uploader;\n","import React from 'react';\n\nconst Sidebar = ({\n  deleteShape,\n  distances,\n  hasVisibleBorders,\n  savedShapes,\n  setDistances,\n  setHasVisibleBorders,\n  setSteps,\n  steps\n}) => {\n  const updateSetting = (value, index, func) => {\n    if (!value) {\n      return;\n    }\n    func(v => {\n      v[index] = Math.max(1, parseInt(value));\n      return [...v];\n    })\n  }\n\n  return (\n    <>\n    <div className=\"boxes\">\n      {savedShapes.map((shape, index) => (\n        <div className=\"row\" key={`${index}_${shape.join('-')}`}>\n          <p className=\"row-title\">Box {index}</p>\n          <div className=\"input-row\">\n            Number of steps\n            <input type=\"number\" value={steps[index]} onChange={e => updateSetting(e.target.value, index, setSteps)} />\n          </div>\n          <div className=\"input-row\">\n            Step width divisor\n            <input type=\"number\" value={distances[index]} onChange={e => updateSetting(e.target.value, index, setDistances)} />\n          </div>\n          <button onClick={() => deleteShape(index)}>Delete</button>\n        </div>\n      ))}\n      </div>\n      <div className=\"row options\">\n        <input type=\"checkbox\" checked={hasVisibleBorders} onChange={() => setHasVisibleBorders(!hasVisibleBorders)} />\n        Display borders\n      </div>\n    </>\n  );\n}\n\nexport default Sidebar;\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\n\nconst Canvas = ({ addShape, canvasRef, imageUrl, savedShapes, setIsLoading }) => {\n  const currentShapeRef = useRef([0, 0, 0, 0]);\n\n  const [isVerticalRatio, setIsVerticalRatio] = useState(false);\n  const [image, setImage] = useState(null);\n  useEffect(() => {\n    if (!imageUrl) {\n      return;\n    }\n    setIsLoading(true);\n    const img = new Image();\n    img.src = imageUrl;\n    img.decoding = 'async';\n    img.decode().then(() => {\n      setIsVerticalRatio(img.width < img.height);\n      setIsLoading(false);\n      setImage(img);\n    });\n  }, [canvasRef, imageUrl, setIsLoading]);\n\n\n  const [drawRectContext, setDrawRectContext] = useState(null);\n  const refreshImage = useCallback(async (context) => {\n    if (!image) {\n      return;\n    }\n    if (image.width > image.height) {\n      setIsVerticalRatio(false);\n      canvasRef.current.width = canvasRef.current.clientWidth;\n      canvasRef.current.height = (canvasRef.current.clientWidth / image.width) * image.height\n    } else {\n      setIsVerticalRatio(true);\n      canvasRef.current.height = canvasRef.current.clientHeight;\n      canvasRef.current.width = (canvasRef.current.clientHeight / image.height) * image.width\n    }\n    context.drawImage(image, 0, 0, canvasRef.current.width, canvasRef.current.height);\n  }, [canvasRef, image]);\n\n  const refreshShapes = useCallback((context) => {\n    savedShapes.map(([startX, startY, width, height], i) => {\n      context.strokeStyle = 'transparent'\n      context.strokeRect(startX, startY, width, height);\n      return true;\n    })\n  }, [savedShapes]);\n\n\n  const redrawCanvas = useCallback(async (sharedContext) => {\n    if (!sharedContext && !canvasRef.current) {\n      return;\n    }\n    const context = sharedContext ?? canvasRef.current.getContext('2d');\n    context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    refreshImage(context);\n    refreshShapes(context);\n  }, [canvasRef, refreshImage, refreshShapes]);\n\n  useEffect(() => {\n    redrawCanvas();\n  }, [redrawCanvas, imageUrl]);\n\n  const getCanvasCoords = function (clientX, clientY) {\n    var rect = canvasRef.current.getBoundingClientRect();\n\n    return {\n      x: clientX - rect.left,\n      y: clientY - rect.top\n    };\n  };\n\n  const onMouseDown = event => {\n    const context = canvasRef.current.getContext('2d');\n    setDrawRectContext(context);\n    const coords = getCanvasCoords(event.clientX, event.clientY);\n    currentShapeRef.current = [coords.x, coords.y, 0, 0];\n  };\n\n  const onMouseUp = event => {\n    setDrawRectContext(null);\n    if (!currentShapeRef.current[2] === 0 || currentShapeRef.current[3] === 0) {\n      return;\n    }\n    addShape(currentShapeRef.current);\n  }\n\n  const onMouseMove = event => {\n    if (!drawRectContext) {\n      return;\n    }\n\n    redrawCanvas(drawRectContext);\n\n    const [startX, startY] = currentShapeRef.current;\n    const coords = getCanvasCoords(event.clientX, event.clientY);\n    const width = coords.x - startX;\n    const height = coords.y - startY;\n\n    drawRectContext.strokeStyle = 'blue'\n    drawRectContext.strokeRect(startX, startY, width, height);\n    currentShapeRef.current = [startX, startY, width, height]\n  };\n\n  const onMouseLeave = () => {\n    if (drawRectContext) {\n      onMouseUp();\n      return;\n    }\n  }\n\n  return (\n    <canvas\n      className={`canvas ${isVerticalRatio ? 'is-vertical' : ''}`}\n      onMouseDown={imageUrl ? onMouseDown : null}\n      onMouseUp={imageUrl ? onMouseUp : null}\n      onMouseLeave={imageUrl ? onMouseLeave : null}\n      onMouseMove={imageUrl ? onMouseMove : null}\n      ref={canvasRef}\n    />\n  );\n}\n\nexport default Canvas;\n","import './App.css';\nimport React, { useRef, useState } from 'react';\nimport Uploader from './Uploader/Uploader';\nimport Sidebar from './Sidebar/Sidebar';\nimport Canvas from './Canvas/Canvas';\n\nconst API_URL = process.env.NODE_ENV === 'development' ? 'http://127.0.0.1:5000' : '';\n\nfunction App() {\n  const canvasRef = useRef();\n  const [imageFilename, setImageFilename] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const [savedShapes, setSavedShapes] = useState([]);\n  const [hasVisibleBorders, setHasVisibleBorders] = useState(false);\n\n  const [steps, setSteps] = useState([]);\n  const [distances, setDistances] = useState([]);\n\n  const resetState = async event => {\n    setImageFilename(null);\n    setSavedShapes([]);\n    setSteps([]);\n    setDistances([]);\n  };\n\n  const addShape = shape => {\n    setSavedShapes([...savedShapes, shape]);\n    setDistances([...distances, 5]);\n    setSteps([...steps, 5]);\n  }\n\n  const removeFromArray = (array, index) => array.map((value, i) => index === i ? false : value).filter(exists => exists)\n  const deleteShape = index => {\n    setDistances(removeFromArray(distances, index));\n    setSteps(removeFromArray(steps, index));\n    setSavedShapes(removeFromArray(savedShapes, index));\n  }\n\n  const imageUrl = (isPreview = true) => savedShapes.length > 0 \n    ? `${API_URL}/composition/${isPreview ? 'preview_' : ''}${imageFilename}?boxes=${JSON.stringify(savedShapes)}&width=${canvasRef.current.width}&showBorders=${hasVisibleBorders}&steps=${JSON.stringify(steps)}&distances=${JSON.stringify(distances)}`\n    : `${API_URL}/static/uploads/preview_${imageFilename}`;\n\n  return (\n    <div className=\"page\">\n      <div className={`main ${!imageFilename ? 'is-empty' : ''}`}>\n        <Canvas\n          addShape={addShape}\n          canvasRef={canvasRef}\n          imageUrl={imageFilename ? imageUrl() : null}\n          savedShapes={savedShapes}\n          setIsLoading={setIsLoading}\n        />\n        {isLoading && <div className=\"loader\" />}\n      </div>\n      <div className=\"sidebar\">\n        <Sidebar\n          deleteShape={deleteShape}\n          distances={distances}\n          hasVisibleBorders={hasVisibleBorders}\n          savedShapes={savedShapes}\n          setDistances={setDistances}\n          setHasVisibleBorders={setHasVisibleBorders}\n          setSteps={setSteps}\n          steps={steps}\n        /> \n        <Uploader API_URL={API_URL} resetState={resetState} setImageFilename={setImageFilename} setIsLoading={setIsLoading} />\n        <a href={imageUrl(false)} target=\"_blank\" className=\"downloader\">Save high quality</a>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}